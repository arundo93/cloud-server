var H=Object.defineProperty;var A=(n,t,c)=>t in n?H(n,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):n[t]=c;var R=(n,t,c)=>A(n,typeof t!="symbol"?t+"":t,c);import{j as e,r as d,d as $,e as z,R as T,p as M,i as D,f as G,h as P,k as Z,u as W,b as Y,A as K}from"./api-Dt8iYW10.js";const q="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='40'%20cy='20'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='40'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='60'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",U="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M36.5%2046V18.5H43.5V46C43.5%2047.3807%2044.6193%2048.5%2046%2048.5H50.7974L41.7145%2059.3995C40.3575%2061.0279%2041.5155%2063.5%2043.635%2063.5H63.5V64.5H16.5V63.5H36.365C38.4846%2063.5%2039.6424%2061.0279%2038.2855%2059.3995L29.2026%2048.5H34C35.3807%2048.5%2036.5%2047.3807%2036.5%2046ZM51.4808%2047.6799L51.4801%2047.6808L51.4808%2047.6799Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",Q="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.4395%2049.1875L36.8032%2062.0992C39.673%2063.756%2043.3425%2062.7728%2044.9994%2059.903L63.1016%2028.549C63.6539%2027.5925%2063.3261%2026.3693%2062.3696%2025.817L60.6375%2024.817C59.6809%2024.2647%2058.4577%2024.5925%2057.9055%2025.549L41.8032%2053.4389C40.6986%2055.3521%2038.2523%2056.0076%2036.3391%2054.903L16.4003%2043.3913C15.2524%2042.7286%2013.7845%2043.1219%2013.1218%2044.2698C12.1277%2045.9916%2012.7177%2048.1934%2014.4395%2049.1875Z'%20fill='%2300FF00'/%3e%3c/svg%3e",J="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M20.648%2058.3191L24.5995%2045.9482L54.9086%2015.6391L63.8528%2023.6655L36.2782%2051.2401L32.7507%2048.1247C31.7609%2047.2505%2030.2619%2047.297%2029.328%2048.2308L29.0307%2048.5281C28.0113%2049.5475%2028.063%2051.2154%2029.1435%2052.1697L31.7166%2054.4422L20.648%2058.3191ZM32.5217%2054.1602L32.521%2054.1605L32.5217%2054.1602Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3crect%20x='13.5'%20y='62.5978'%20width='49'%20height='3'%20fill='black'%20stroke='black'/%3e%3c/svg%3e",X="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='16'%20y='21'%20width='48'%20height='2'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M52%2064H28C25.2386%2064%2023%2061.7614%2023%2059V29C23%2028.4477%2023.4477%2028%2024%2028H24.2353C24.7876%2028%2025.2353%2028.4477%2025.2353%2029V57C25.2353%2059.7614%2027.4739%2062%2030.2353%2062H49.7647C52.5261%2062%2054.7647%2059.7614%2054.7647%2057V29C54.7647%2028.4477%2055.2124%2028%2055.7647%2028H56C56.5523%2028%2057%2028.4477%2057%2029V59C57%2061.7614%2054.7614%2064%2052%2064Z'%20fill='%23FF0000'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='34'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='44'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M32%2016C32%2014.8954%2032.8954%2014%2034%2014H46C47.1046%2014%2048%2014.8954%2048%2016V20H32V16Z'%20fill='%23FF0000'/%3e%3c/svg%3e",ee="modulepreload",te=function(n){return"/"+n},V={},ne=function(t,c,i){let g=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));g=Promise.allSettled(c.map(h=>{if(h=te(h),h in V)return;V[h]=!0;const r=h.endsWith(".css"),s=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${s}`))return;const l=document.createElement("link");if(l.rel=r?"stylesheet":ee,r||(l.as="script"),l.crossOrigin="",l.href=h,u&&l.setAttribute("nonce",u),document.head.appendChild(l),r)return new Promise((m,f)=>{l.addEventListener("load",m),l.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return g.then(a=>{for(const u of a||[])u.status==="rejected"&&o(u.reason);return t().catch(o)})};function se({text:n}){return e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("div",{className:"loading-text",children:n})]})}const E="/assets/arrow-qCuS77Qj.svg";function ae({min:n,max:t,onChange:c}){const i=o=>{const a=parseInt(o.target.value);c({min:a,max:Math.max(a,t)})},g=o=>{const a=parseInt(o.target.value);c({min:Math.min(n,a),max:a})};return e.jsxs("div",{className:"image__tool",children:[e.jsx("div",{children:"Canny Filter"}),e.jsxs("div",{className:"image__tool-slider",children:[e.jsx("span",{children:"min"}),e.jsx("input",{type:"range",min:"0",max:"255",value:n,onChange:i}),e.jsx("span",{children:`${n}   `.slice(0,3)})]}),e.jsxs("div",{className:"image__tool-slider",children:[e.jsx("span",{children:"max"}),e.jsx("input",{type:"range",min:"0",max:"255",value:t,onChange:g}),e.jsx("span",{children:`${t}   `.slice(0,3)})]})]})}function le({kernelSize:n,onChange:t}){const c=i=>{const g=parseInt(i.target.value);t(g)};return e.jsxs("div",{className:"image__tool",children:[e.jsx("div",{children:"Dilate Filter"}),e.jsxs("div",{className:"image__tool-number",children:[e.jsx("span",{children:"Kernel Size"}),e.jsx("input",{type:"number",min:"1",max:"30",value:n,onChange:c})]})]})}const N=["rgb","gray","hsv","lab"],ie={rgb:"RGB",gray:"Gray",hsv:"HSV",lab:"Lab"};function ce({colorSpace:n,onChange:t}){const c=N.indexOf(n),i=d.useCallback(g=>{const o=Math.max(Math.min(c+g,N.length-1),0);t(N[o])},[t,c]);return e.jsxs("div",{className:"image__tool",children:[e.jsx("div",{children:"Color space"}),e.jsxs("div",{className:"image__tool-select",children:[e.jsx("div",{onClick:()=>{i(-1)},children:"<"}),e.jsx("div",{children:ie[n]}),e.jsx("div",{onClick:()=>{i(1)},children:">"})]})]})}function F(n){return n.length<4?"#ffffff":"#"+n.map(t=>("00"+t.toString(16)).slice(-2)).join("").slice(0,6)}function I(n){var t;return n.length<7?[0,0,0,0]:(t=n.match(/[a-f0-9]{2}/g))==null?void 0:t.map(c=>parseInt(c,16))}function oe({lowColor:n,highColor:t,onChange:c}){const i=o=>{const a=I(o.target.value);a&&c(a.concat([255]),t)},g=o=>{const a=I(o.target.value);a&&c(n,a.concat([255]))};return e.jsxs("div",{className:"image__tool",children:[e.jsx("div",{children:"Color range"}),e.jsxs("div",{className:"image__tool-color",children:[e.jsx("span",{children:"min"}),e.jsx("input",{type:"color",value:F(n),style:{"--color":F(n)},onChange:i}),e.jsx("span",{children:"|"}),e.jsx("span",{children:"max"}),e.jsx("input",{type:"color",value:F(t),style:{"--color":F(t)},onChange:g})]})]})}const re=["Color","Canny","Dilate","Range mask"];function de({tools:n,setTools:t}){const[c,i]=d.useState(!1),g=d.useCallback(s=>{t(l=>l.combination.includes(s)?{...l,combination:l.combination.filter(m=>m!==s)}:l.combination.includes("Dilate")&&s==="Canny"?{...l,combination:[s,...l.combination]}:l.combination.includes("Canny")&&s==="Dilate"?{...l,combination:[...l.combination,s]}:{...l,combination:[s]})},[t]),o=d.useCallback(s=>{t(l=>({...l,colorSpace:s}))},[t]),a=d.useCallback(s=>{const{min:l,max:m}=s;t(f=>({...f,canny:{min:l,max:m}}))},[t]),u=d.useCallback(s=>{t(l=>({...l,dilate:{kernelSize:s}}))},[t]),h=d.useCallback((s,l)=>{t(m=>({...m,inRange:{lowColor:s,highColor:l}}))},[t]),r=(s,l)=>{switch(s){case"Color":return e.jsx(ce,{colorSpace:n.colorSpace,onChange:o},l);case"Canny":return e.jsx(ae,{min:n.canny.min,max:n.canny.max,onChange:a},l);case"Dilate":return e.jsx(le,{kernelSize:n.dilate.kernelSize,onChange:u},l);case"Range mask":return e.jsx(oe,{lowColor:n.inRange.lowColor,highColor:n.inRange.highColor,onChange:h},l)}};return e.jsxs("div",{className:"image__tools-container",children:[e.jsxs("div",{className:"image__tools",children:[e.jsxs("div",{className:"image__tools-title",onClick:()=>{i(s=>!s)},children:[e.jsx("div",{children:"Инструменты"}),e.jsx("img",{src:E,height:"20px",style:c?{}:{rotate:"180deg"}})]}),e.jsx("div",{className:`image__tools-list${c?" active":""}`,children:re.map((s,l)=>e.jsx("div",{className:`image__tools-element${n.combination.includes(s)?" active":""}`,onClick:()=>{g(s)},children:s},"OpenCV-tool-selector"+s+l))})]}),n.combination.map((s,l)=>r(s,"OpenCVTool"+s+l))]})}const he={enable:!1,combination:[],colorSpace:"rgb",canny:{min:0,max:0},dilate:{kernelSize:1},inRange:{lowColor:[0,0,0,255],highColor:[255,255,255,255]}};function ge({fileUrl:n}){const[t,c]=d.useState(null),[i,g]=d.useState(he),[o,a]=d.useState(null),u=d.useRef(null),h=d.useId();d.useEffect(()=>{if(!i.enable)return;let s=new t.Mat;for(let l of i.combination)switch(l){case"Color":switch(i.colorSpace){case"rgb":t.imshow(h,o);break;case"gray":t.cvtColor(o,s,t.COLOR_RGBA2GRAY,0);break;case"hsv":t.cvtColor(o,s,t.COLOR_RGB2HSV,0);break;case"lab":t.cvtColor(o,s,t.COLOR_RGB2Lab,0);break}break;case"Canny":t.cvtColor(o,s,t.COLOR_RGB2GRAY,0),t.Canny(o,s,i.canny.min,i.canny.max,3,!1);break;case"Dilate":let m=t.Mat.ones(i.dilate.kernelSize,i.dilate.kernelSize,t.CV_8U),f=new t.Point(-1,-1);t.dilate(s.cols&&s.rows?s:o,s,m,f,1,t.BORDER_CONSTANT,t.morphologyDefaultBorderValue()),m.delete();break;case"Range mask":let x=new t.Mat(o.rows,o.cols,o.type(),i.inRange.lowColor),v=new t.Mat(o.rows,o.cols,o.type(),i.inRange.highColor);t.inRange(o,x,v,s),x.delete(),v.delete();break}s.cols&&s.rows&&t.imshow(h,s),s.delete()},[i,o,h,t]);const r=()=>{if(t)try{a(t.imread(u.current)),g(s=>({...s,enable:!0}))}catch(s){console.log(s)}};return d.useEffect(()=>{(async()=>{const{cvFactory:l}=await ne(async()=>{const{cvFactory:m}=await import("./opencv-BfzHwUv7.js");return{cvFactory:m}},[]);l.then(m=>{c(m),console.log("OpenCV.js loaded")})})()},[]),e.jsx(e.Fragment,{children:t?e.jsxs("div",{className:"file-content",children:[e.jsx(de,{tools:i,setTools:g}),e.jsx("img",{ref:u,src:n,onLoad:r}),e.jsx("canvas",{id:h})]}):e.jsx(se,{text:"OpenCV.js is loading..."})})}function me({fileUrl:n}){const[t,c]=n.split("/").slice(-2),i=d.useRef(null);return d.useEffect(()=>{$(t,c).then(g=>{g&&(console.log(g),ue({canvasRef:i.current,...g}))})},[]),e.jsx("div",{className:"detector-container",children:e.jsxs("div",{className:"detector-image",children:[e.jsx("canvas",{className:"detector-canvas",ref:i}),e.jsx("img",{src:n})]})})}const ue=({canvasRef:n,boxes_data:t,scores_data:c,classes_data:i,ratios:g,shape:o})=>{const a=n.getContext("2d");if(!a){console.log("No canvas for display detection results!");return}const{w:u,h}=o,{xRatio:r,yRatio:s}=g;n.width=u,n.height=h,a.clearRect(0,0,a.canvas.width,a.canvas.height);const l=new L,m=`${Math.max(Math.round(Math.max(a.canvas.width,a.canvas.height)/40),14)}px Arial`;a.font=m,a.textBaseline="top";const f=[];for(let x=0;x<c.length;++x){const v=i[x].class,w=l.get(i[x].idx),j=(c[x]*100).toFixed(1);let[C,p,_,b]=t.slice(x*4,(x+1)*4);p/=r,b/=r,C/=s,_/=s;const y=b-p,S=_-C;a.fillStyle=L.hexToRgba(w,.2)||"rgba(25, 255, 25, 1)",a.fillRect(p,C,y,S),f.push({x1:p,y1:C,x2:b,y2:_,width:y,height:S}),a.strokeStyle=w,a.lineWidth=Math.max(Math.min(a.canvas.width,a.canvas.height)/200,2.5),a.strokeRect(p,C,y,S),a.fillStyle=w;const B=a.measureText(v+" - "+j+"%").width,O=parseInt(m,10),k=C-(O+a.lineWidth);a.fillRect(p-1,k<0?0:k,B+a.lineWidth,O+a.lineWidth),a.fillStyle="#ffffff",a.fillText(v+" - "+j+"%",p-1,k<0?0:k)}console.log(f)};class L{constructor(){R(this,"get",t=>this.palette[Math.floor(t)%this.n]);this.palette=["#FF3838","#FF9D97","#FF701F","#FFB21D","#CFD231","#48F90A","#92CC17","#3DDB86","#1A9334","#00D4BB","#2C99A8","#00C2FF","#344593","#6473FF","#0018EC","#8438FF","#520085","#CB38FF","#FF95C8","#FF37C7"],this.n=this.palette.length}}R(L,"hexToRgba",(t,c)=>{const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?`rgba(${[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)].join(", ")}, ${c})`:null});function xe({controls:n}){return e.jsx("div",{className:"detector__controls",children:n.map((t,c)=>e.jsx("div",{className:`detector__controls-item${t.isActive?" active":""}`,onClick:t.onClick,children:t.title},"file-controls"+c))})}function fe({fileUrl:n}){return e.jsx("div",{className:"detector-container",children:e.jsx("div",{className:"detector-image",children:e.jsx("img",{src:n})})})}function Ce({fileName:n,fileUrl:t,deleteFile:c,renameFile:i}){const[g,o]=d.useState(!1),[a,u]=d.useState(!1),[h,r]=d.useState(""),[s,l]=d.useState(!1),[m,f]=d.useState("Viewer"),x=d.useCallback(()=>{o(C=>!C)},[o]),v=d.useCallback(({target:C})=>{r(z(C.value))},[r]),w=d.useCallback(()=>{a?(i(n,h),u(!1),x()):(r(n),u(!0))},[a,h,u,i,x,r]),j=d.useCallback(()=>{l(C=>!C)},[l]);return e.jsxs(T.Fragment,{children:[e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"file__attribute",children:e.jsx("svg",{viewBox:"0 0 12 16",xmlns:"http://www.w3.org/2000/svg",className:"file__icon",style:{width:"16px",height:"16px"},children:e.jsx("path",{d:"M8 0H1.6C.72 0 .008.72.008 1.6L0 14.4c0 .88.712 1.6 1.592 1.6H11.2c.88 0 1.6-.72 1.6-1.6V4.8L8 0zm1.6 12.8H3.2v-1.6h6.4v1.6zm0-3.2H3.2V8h6.4v1.6zm-2.4-4V1.2l4.4 4.4H7.2z"})})}),e.jsx("div",{className:"file__attribute",style:{flex:"3 1 30px",overflow:"hidden"},onClick:()=>!a&&j(),children:a?e.jsx("input",{value:h,onChange:v}):!!n&&n||"Без имени"}),e.jsx("div",{className:"file__attribute",children:e.jsxs("div",{className:"file__controls",children:[g&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:t,download:n,onClick:x,children:e.jsx("div",{className:"file__controls-item",children:e.jsx("img",{src:U})})}),e.jsx("div",{className:"file__controls-item",onClick:w,children:a?e.jsx("img",{src:Q}):e.jsx("img",{src:J})}),e.jsx("div",{className:"file__controls-item",onClick:()=>c(n),children:e.jsx("img",{src:X})})]}),e.jsx("div",{className:"file__controls-item",children:e.jsx("img",{src:q,onClick:x})})]})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{controls:[{title:"Просмотр",isActive:m=="Viewer",onClick:()=>{f("Viewer")}},{title:"OpenCV",isActive:m=="OpenCV",onClick:()=>{f("OpenCV")}},{title:"YOLOv8l",isActive:m=="YOLOv8l",onClick:()=>{f("YOLOv8l")}}]}),ve(m,t)]})]})}function ve(n,t){switch(n){case"Viewer":return e.jsx(fe,{fileUrl:t});case"OpenCV":return e.jsx(ge,{fileUrl:t});case"YOLOv8l":return e.jsx(me,{fileUrl:t})}}function pe({uploadFiles:n}){const[t,c]=d.useState(!1),i=d.useId(),g=d.useCallback(()=>{c(!1)},[c]),o=d.useCallback(h=>{h.preventDefault(),c(!0)},[c]),a=d.useCallback(h=>{h.preventDefault(),c(!1),n(h.dataTransfer.files),console.log(h.dataTransfer.files)},[c]);function u(h){h.target.files&&n(h.target.files),console.log(h.target.files)}return e.jsxs("label",{className:"file"+(t?" addfile-dragged":""),htmlFor:i,onDragLeave:g,onDragOver:o,onDrop:a,children:[e.jsxs("div",{className:"explorer__addfile",children:[e.jsx("img",{className:"addfile-icon",src:M}),e.jsx("div",{className:"addfile-text",children:"Нажмите или перетащите файл сюда"})]}),e.jsx("input",{className:"addfile-input",type:"file",multiple:!0,id:i,onChange:u})]})}function we(){const[n,t]=d.useState([]),i=new URLSearchParams(window.location.search).get("name"),g=d.useCallback(r=>{t(s=>D(s.filter(l=>l!==r),r))},[t]),o=d.useCallback(r=>{i&&G(r,i).then(s=>{console.log(s),s.success&&t(l=>l?l.filter(m=>m!==r):[])})},[t]),a=d.useCallback((r,s)=>{i&&P(r,s,i).then(l=>{console.log(l),l.success&&t(m=>D(m.filter(f=>f!==r),s))})},[t]);async function u(r){if(i)for(let s of r)await W(s,i).then(l=>{console.log(l),l.success&&g(s.name)})}function h(r){r.target.files&&u(r.target.files),console.log(r.target.files)}return d.useEffect(()=>(i&&Z(i).then(r=>{typeof r<"u"&&r.length&&t(r)}),()=>{t([])}),[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"controls",children:[e.jsxs("div",{className:"controls__item",onClick:()=>{window.location.href="/"},children:[e.jsx("img",{className:"controls__item-icon",style:{rotate:"-90deg"},src:E}),e.jsx("div",{className:"controls__item-text",children:"Назад"})]}),e.jsxs("label",{className:"controls__item",htmlFor:"controls-input-file",children:[e.jsx("img",{className:"controls__item-icon",src:M}),e.jsx("div",{className:"controls__item-text",children:"Добавить файл"}),e.jsx("input",{type:"file",multiple:!0,id:"controls-input-file",style:{display:"none"},onChange:h})]})]}),e.jsxs("div",{className:"file-explorer",children:[!!n&&!!n.length&&n.map(r=>e.jsx(Ce,{fileName:r,fileUrl:`${window.location.origin}/img/${i}/${r}`,deleteFile:o,renameFile:a},r)),e.jsx(pe,{uploadFiles:u})]})]})}Y.createRoot(document.getElementById("root")).render(e.jsx(K,{children:e.jsx(we,{})}));
