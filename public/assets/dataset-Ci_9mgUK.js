var I=Object.defineProperty;var V=(n,t,a)=>t in n?I(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a;var N=(n,t,a)=>V(n,typeof t!="symbol"?t+"":t,a);import{j as e,r,d as H,e as B,R as M,p as R,i as D,f as A,h as T,k as $,u as P,b as Z,A as W}from"./api-Y5_TfPeL.js";const Y="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='40'%20cy='20'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='40'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='60'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",z="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M36.5%2046V18.5H43.5V46C43.5%2047.3807%2044.6193%2048.5%2046%2048.5H50.7974L41.7145%2059.3995C40.3575%2061.0279%2041.5155%2063.5%2043.635%2063.5H63.5V64.5H16.5V63.5H36.365C38.4846%2063.5%2039.6424%2061.0279%2038.2855%2059.3995L29.2026%2048.5H34C35.3807%2048.5%2036.5%2047.3807%2036.5%2046ZM51.4808%2047.6799L51.4801%2047.6808L51.4808%2047.6799Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",G="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.4395%2049.1875L36.8032%2062.0992C39.673%2063.756%2043.3425%2062.7728%2044.9994%2059.903L63.1016%2028.549C63.6539%2027.5925%2063.3261%2026.3693%2062.3696%2025.817L60.6375%2024.817C59.6809%2024.2647%2058.4577%2024.5925%2057.9055%2025.549L41.8032%2053.4389C40.6986%2055.3521%2038.2523%2056.0076%2036.3391%2054.903L16.4003%2043.3913C15.2524%2042.7286%2013.7845%2043.1219%2013.1218%2044.2698C12.1277%2045.9916%2012.7177%2048.1934%2014.4395%2049.1875Z'%20fill='%2300FF00'/%3e%3c/svg%3e",q="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M20.648%2058.3191L24.5995%2045.9482L54.9086%2015.6391L63.8528%2023.6655L36.2782%2051.2401L32.7507%2048.1247C31.7609%2047.2505%2030.2619%2047.297%2029.328%2048.2308L29.0307%2048.5281C28.0113%2049.5475%2028.063%2051.2154%2029.1435%2052.1697L31.7166%2054.4422L20.648%2058.3191ZM32.5217%2054.1602L32.521%2054.1605L32.5217%2054.1602Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3crect%20x='13.5'%20y='62.5978'%20width='49'%20height='3'%20fill='black'%20stroke='black'/%3e%3c/svg%3e",U="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='16'%20y='21'%20width='48'%20height='2'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M52%2064H28C25.2386%2064%2023%2061.7614%2023%2059V29C23%2028.4477%2023.4477%2028%2024%2028H24.2353C24.7876%2028%2025.2353%2028.4477%2025.2353%2029V57C25.2353%2059.7614%2027.4739%2062%2030.2353%2062H49.7647C52.5261%2062%2054.7647%2059.7614%2054.7647%2057V29C54.7647%2028.4477%2055.2124%2028%2055.7647%2028H56C56.5523%2028%2057%2028.4477%2057%2029V59C57%2061.7614%2054.7614%2064%2052%2064Z'%20fill='%23FF0000'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='34'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='44'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M32%2016C32%2014.8954%2032.8954%2014%2034%2014H46C47.1046%2014%2048%2014.8954%2048%2016V20H32V16Z'%20fill='%23FF0000'/%3e%3c/svg%3e",Q="modulepreload",J=function(n){return"/"+n},S={},K=function(t,a,i){let g=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),d=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));g=Promise.allSettled(a.map(o=>{if(o=J(o),o in S)return;S[o]=!0;const l=o.endsWith(".css"),h=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${h}`))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":Q,l||(c.as="script"),c.crossOrigin="",c.href=o,d&&c.setAttribute("nonce",d),document.head.appendChild(c),l)return new Promise((m,u)=>{c.addEventListener("load",m),c.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${o}`)))})}))}function f(s){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=s,window.dispatchEvent(d),!d.defaultPrevented)throw s}return g.then(s=>{for(const d of s||[])d.status==="rejected"&&f(d.reason);return t().catch(f)})};function X({text:n}){return e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("div",{className:"loading-text",children:n})]})}const ee={enable:!1,colorSpace:"rgb"};function te({fileUrl:n}){const[t,a]=r.useState(null),[i,g]=r.useState(ee),[f,s]=r.useState(null),d=r.useRef(null),o=r.useId(),l=r.useCallback(()=>{g(c=>({...c,colorSpace:c.colorSpace==="rgb"?"gray":"rgb"}))},[g]);r.useEffect(()=>{if(i.enable){if(i.colorSpace==="rgb")t.imshow(o,f);else if(i.colorSpace==="gray"){let c=new t.Mat;t.cvtColor(f,c,t.COLOR_RGBA2GRAY,0),t.imshow(o,c),c.delete()}}},[i,f,o]);const h=()=>{if(t)try{s(t.imread(d.current)),g(c=>({...c,enable:!0}))}catch(c){console.log(c)}};return r.useEffect(()=>{(async()=>{const{cvFactory:m}=await K(async()=>{const{cvFactory:u}=await import("./opencv-BfzHwUv7.js");return{cvFactory:u}},[]);m.then(u=>{a(u),console.log("OpenCV loaded!")})})()},[]),e.jsx(e.Fragment,{children:t?e.jsxs("div",{className:"file-content",children:[e.jsx("div",{className:"image__controls",children:e.jsxs("div",{className:"image__controls-toggle",children:[e.jsx("div",{children:"RGB"}),e.jsx("input",{type:"checkbox",className:"toggle-button",onChange:l}),e.jsx("div",{children:"Gray"})]})}),e.jsx("img",{ref:d,src:n,onLoad:h}),e.jsx("canvas",{id:o})]}):e.jsx(X,{text:"OpenCV.js is loading..."})})}function se({fileUrl:n}){const[t,a]=n.split("/").slice(-2),i=r.useRef(null);return r.useEffect(()=>{H(t,a).then(g=>{g&&(console.log(g),ne({canvasRef:i.current,...g}))})},[]),e.jsx("div",{className:"detector-container",children:e.jsxs("div",{className:"detector-image",children:[e.jsx("canvas",{className:"detector-canvas",ref:i}),e.jsx("img",{src:n})]})})}const ne=({canvasRef:n,boxes_data:t,scores_data:a,classes_data:i,ratios:g,shape:f})=>{const s=n.getContext("2d");if(!s){console.log("No canvas for display detection results!");return}const{w:d,h:o}=f,{xRatio:l,yRatio:h}=g;n.width=d,n.height=o,s.clearRect(0,0,s.canvas.width,s.canvas.height);const c=new L,m=`${Math.max(Math.round(Math.max(s.canvas.width,s.canvas.height)/40),14)}px Arial`;s.font=m,s.textBaseline="top";const u=[];for(let x=0;x<a.length;++x){const C=i[x].class,w=c.get(i[x].idx),F=(a[x]*100).toFixed(1);let[v,p,k,_]=t.slice(x*4,(x+1)*4);p/=l,_/=l,v/=h,k/=h;const y=_-p,b=k-v;s.fillStyle=L.hexToRgba(w,.2)||"rgba(25, 255, 25, 1)",s.fillRect(p,v,y,b),u.push({x1:p,y1:v,x2:_,y2:k,width:y,height:b}),s.strokeStyle=w,s.lineWidth=Math.max(Math.min(s.canvas.width,s.canvas.height)/200,2.5),s.strokeRect(p,v,y,b),s.fillStyle=w;const E=s.measureText(C+" - "+F+"%").width,O=parseInt(m,10),j=v-(O+s.lineWidth);s.fillRect(p-1,j<0?0:j,E+s.lineWidth,O+s.lineWidth),s.fillStyle="#ffffff",s.fillText(C+" - "+F+"%",p-1,j<0?0:j)}console.log(u)};class L{constructor(){N(this,"get",t=>this.palette[Math.floor(t)%this.n]);this.palette=["#FF3838","#FF9D97","#FF701F","#FFB21D","#CFD231","#48F90A","#92CC17","#3DDB86","#1A9334","#00D4BB","#2C99A8","#00C2FF","#344593","#6473FF","#0018EC","#8438FF","#520085","#CB38FF","#FF95C8","#FF37C7"],this.n=this.palette.length}}N(L,"hexToRgba",(t,a)=>{const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?`rgba(${[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)].join(", ")}, ${a})`:null});function le({controls:n}){return e.jsx("div",{className:"detector__controls",children:n.map((t,a)=>e.jsx("div",{className:`detector__controls-item${t.isActive?" active":""}`,onClick:t.onClick,children:t.title},"file-controls"+a))})}function ce({fileName:n,fileUrl:t,deleteFile:a,renameFile:i}){const[g,f]=r.useState(!1),[s,d]=r.useState(!1),[o,l]=r.useState(""),[h,c]=r.useState(!1),[m,u]=r.useState("OpenCV"),x=r.useCallback(()=>{f(v=>!v)},[f]),C=r.useCallback(({target:v})=>{l(B(v.value))},[l]),w=r.useCallback(()=>{s?(i(n,o),d(!1),x()):(l(n),d(!0))},[s,o,d,i,x,l]),F=r.useCallback(()=>{c(v=>!v)},[c]);return e.jsxs(M.Fragment,{children:[e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"file__attribute",children:e.jsx("svg",{viewBox:"0 0 12 16",xmlns:"http://www.w3.org/2000/svg",className:"file__icon",style:{width:"16px",height:"16px"},children:e.jsx("path",{d:"M8 0H1.6C.72 0 .008.72.008 1.6L0 14.4c0 .88.712 1.6 1.592 1.6H11.2c.88 0 1.6-.72 1.6-1.6V4.8L8 0zm1.6 12.8H3.2v-1.6h6.4v1.6zm0-3.2H3.2V8h6.4v1.6zm-2.4-4V1.2l4.4 4.4H7.2z"})})}),e.jsx("div",{className:"file__attribute",style:{flex:"3 1 30px",overflow:"hidden"},onClick:()=>!s&&F(),children:s?e.jsx("input",{value:o,onChange:C}):!!n&&n||"Без имени"}),e.jsx("div",{className:"file__attribute",children:e.jsxs("div",{className:"file__controls",children:[g&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:t,download:n,onClick:x,children:e.jsx("div",{className:"file__controls-item",children:e.jsx("img",{src:z})})}),e.jsx("div",{className:"file__controls-item",onClick:w,children:s?e.jsx("img",{src:G}):e.jsx("img",{src:q})}),e.jsx("div",{className:"file__controls-item",onClick:()=>a(n),children:e.jsx("img",{src:U})})]}),e.jsx("div",{className:"file__controls-item",children:e.jsx("img",{src:Y,onClick:x})})]})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(le,{controls:[{title:"OpenCV",isActive:m=="OpenCV",onClick:()=>{u("OpenCV")}},{title:"YOLOv8l",isActive:m=="YOLOv8l",onClick:()=>{u("YOLOv8l")}}]}),ie(m,t)]})]})}function ie(n,t){switch(n){case"OpenCV":return e.jsx(te,{fileUrl:t});case"YOLOv8l":return e.jsx(se,{fileUrl:t})}}function oe({uploadFiles:n}){const[t,a]=r.useState(!1),i=r.useId(),g=r.useCallback(()=>{a(!1)},[a]),f=r.useCallback(o=>{o.preventDefault(),a(!0)},[a]),s=r.useCallback(o=>{o.preventDefault(),a(!1),n(o.dataTransfer.files),console.log(o.dataTransfer.files)},[a]);function d(o){o.target.files&&n(o.target.files),console.log(o.target.files)}return e.jsxs("label",{className:"file"+(t?" addfile-dragged":""),htmlFor:i,onDragLeave:g,onDragOver:f,onDrop:s,children:[e.jsxs("div",{className:"explorer__addfile",children:[e.jsx("img",{className:"addfile-icon",src:R}),e.jsx("div",{className:"addfile-text",children:"Нажмите или перетащите файл сюда"})]}),e.jsx("input",{className:"addfile-input",type:"file",multiple:!0,id:i,onChange:d})]})}const ae="/assets/arrow-qCuS77Qj.svg";function re(){const[n,t]=r.useState([]),i=new URLSearchParams(window.location.search).get("name"),g=r.useCallback(l=>{t(h=>D(h.filter(c=>c!==l),l))},[t]),f=r.useCallback(l=>{i&&A(l,i).then(h=>{console.log(h),h.success&&t(c=>c?c.filter(m=>m!==l):[])})},[t]),s=r.useCallback((l,h)=>{i&&T(l,h,i).then(c=>{console.log(c),c.success&&t(m=>D(m.filter(u=>u!==l),h))})},[t]);async function d(l){if(i)for(let h of l)await P(h,i).then(c=>{console.log(c),c.success&&g(h.name)})}function o(l){l.target.files&&d(l.target.files),console.log(l.target.files)}return r.useEffect(()=>(i&&$(i).then(l=>{typeof l<"u"&&l.length&&t(l)}),()=>{t([])}),[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"controls",children:[e.jsxs("div",{className:"controls__item",onClick:()=>{window.location.href="/"},children:[e.jsx("img",{className:"controls__item-icon",style:{rotate:"-90deg"},src:ae}),e.jsx("div",{className:"controls__item-text",children:"Назад"})]}),e.jsxs("label",{className:"controls__item",htmlFor:"controls-input-file",children:[e.jsx("img",{className:"controls__item-icon",src:R}),e.jsx("div",{className:"controls__item-text",children:"Добавить файл"}),e.jsx("input",{type:"file",multiple:!0,id:"controls-input-file",style:{display:"none"},onChange:o})]})]}),e.jsxs("div",{className:"file-explorer",children:[!!n&&!!n.length&&n.map(l=>e.jsx(ce,{fileName:l,fileUrl:`${window.location.origin}/img/${i}/${l}`,deleteFile:f,renameFile:s},l)),e.jsx(oe,{uploadFiles:d})]})]})}Z.createRoot(document.getElementById("root")).render(e.jsx(W,{children:e.jsx(re,{})}));
