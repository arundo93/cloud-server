var I=Object.defineProperty;var H=(o,s,c)=>s in o?I(o,s,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[s]=c;var b=(o,s,c)=>H(o,typeof s!="symbol"?s+"":s,c);import{r,j as e,d as M,R as B,p as R,i as S,e as O,f as V,h as T,u as A,b as $,A as P}from"./images-CmLipUHc.js";const Z="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='40'%20cy='20'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='40'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='60'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",W="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M36.5%2046V18.5H43.5V46C43.5%2047.3807%2044.6193%2048.5%2046%2048.5H50.7974L41.7145%2059.3995C40.3575%2061.0279%2041.5155%2063.5%2043.635%2063.5H63.5V64.5H16.5V63.5H36.365C38.4846%2063.5%2039.6424%2061.0279%2038.2855%2059.3995L29.2026%2048.5H34C35.3807%2048.5%2036.5%2047.3807%2036.5%2046ZM51.4808%2047.6799L51.4801%2047.6808L51.4808%2047.6799Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",z="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.4395%2049.1875L36.8032%2062.0992C39.673%2063.756%2043.3425%2062.7728%2044.9994%2059.903L63.1016%2028.549C63.6539%2027.5925%2063.3261%2026.3693%2062.3696%2025.817L60.6375%2024.817C59.6809%2024.2647%2058.4577%2024.5925%2057.9055%2025.549L41.8032%2053.4389C40.6986%2055.3521%2038.2523%2056.0076%2036.3391%2054.903L16.4003%2043.3913C15.2524%2042.7286%2013.7845%2043.1219%2013.1218%2044.2698C12.1277%2045.9916%2012.7177%2048.1934%2014.4395%2049.1875Z'%20fill='%2300FF00'/%3e%3c/svg%3e",G="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M20.648%2058.3191L24.5995%2045.9482L54.9086%2015.6391L63.8528%2023.6655L36.2782%2051.2401L32.7507%2048.1247C31.7609%2047.2505%2030.2619%2047.297%2029.328%2048.2308L29.0307%2048.5281C28.0113%2049.5475%2028.063%2051.2154%2029.1435%2052.1697L31.7166%2054.4422L20.648%2058.3191ZM32.5217%2054.1602L32.521%2054.1605L32.5217%2054.1602Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3crect%20x='13.5'%20y='62.5978'%20width='49'%20height='3'%20fill='black'%20stroke='black'/%3e%3c/svg%3e",q="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='16'%20y='21'%20width='48'%20height='2'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M52%2064H28C25.2386%2064%2023%2061.7614%2023%2059V29C23%2028.4477%2023.4477%2028%2024%2028H24.2353C24.7876%2028%2025.2353%2028.4477%2025.2353%2029V57C25.2353%2059.7614%2027.4739%2062%2030.2353%2062H49.7647C52.5261%2062%2054.7647%2059.7614%2054.7647%2057V29C54.7647%2028.4477%2055.2124%2028%2055.7647%2028H56C56.5523%2028%2057%2028.4477%2057%2029V59C57%2061.7614%2054.7614%2064%2052%2064Z'%20fill='%23FF0000'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='34'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='44'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M32%2016C32%2014.8954%2032.8954%2014%2034%2014H46C47.1046%2014%2048%2014.8954%2048%2016V20H32V16Z'%20fill='%23FF0000'/%3e%3c/svg%3e",U="modulepreload",J=function(o){return"/"+o},E={},Y=function(s,c,i){let g=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),d=(t==null?void 0:t.nonce)||(t==null?void 0:t.getAttribute("nonce"));g=Promise.allSettled(c.map(a=>{if(a=J(a),a in E)return;E[a]=!0;const l=a.endsWith(".css"),h=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${h}`))return;const n=document.createElement("link");if(n.rel=l?"stylesheet":U,l||(n.as="script"),n.crossOrigin="",n.href=a,d&&n.setAttribute("nonce",d),document.head.appendChild(n),l)return new Promise((u,f)=>{n.addEventListener("load",u),n.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${a}`)))})}))}function m(t){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=t,window.dispatchEvent(d),!d.defaultPrevented)throw t}return g.then(t=>{for(const d of t||[])d.status==="rejected"&&m(d.reason);return s().catch(m)})},K={enable:!1,colorSpace:"color"};function Q({fileUrl:o}){const[s,c]=r.useState(null),[i,g]=r.useState(K),[m,t]=r.useState(null),d=r.useRef(null),a=r.useId(),l=r.useCallback(()=>{g(n=>({...n,colorSpace:n.colorSpace==="color"?"gray":"color"}))},[g]);r.useEffect(()=>{if(i.enable){if(i.colorSpace==="color")s.imshow(a,m);else if(i.colorSpace==="gray"){let n=new s.Mat;s.cvtColor(m,n,s.COLOR_RGBA2GRAY,0),s.imshow(a,n),n.delete()}}},[i,m,a]);const h=()=>{if(s)try{t(s.imread(d.current)),g(n=>({...n,enable:!0}))}catch(n){console.log(n)}};return r.useEffect(()=>{(async()=>{const{cvFactory:u}=await Y(async()=>{const{cvFactory:f}=await import("./opencv-BfzHwUv7.js");return{cvFactory:f}},[]);u.then(f=>{c(f),console.log("CV loaded!")})})()},[]),e.jsxs("div",{className:"file-content",children:[e.jsx("div",{className:"image__controls",children:e.jsxs("div",{className:"image__controls-toggle",children:[e.jsx("div",{children:"Color"}),e.jsx("input",{type:"checkbox",className:"toggle-button",onChange:l}),e.jsx("div",{children:"Gray"})]})}),!!s&&e.jsxs(e.Fragment,{children:[e.jsx("img",{ref:d,src:o,onLoad:h}),e.jsx("canvas",{id:a})]})]})}function X({fileUrl:o}){const[s,c]=o.split("/").slice(-2),i=r.useRef(null);return r.useEffect(()=>{ee(s,c).then(g=>{g&&(console.log(g),te({canvasRef:i.current,...g}))})},[]),e.jsxs("div",{className:"detector-container",children:[e.jsx("canvas",{className:"detector-canvas",ref:i}),e.jsx("img",{src:o})]})}function ee(o,s){return fetch(window.location.origin+"/api/predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({foldername:o,filename:s})}).then(c=>{if(c.ok)return c.json();(c.status===400||c.status===500)&&c.json().then(i=>{console.log(i)})})}const te=({canvasRef:o,boxes_data:s,scores_data:c,classes_data:i,ratios:g,shape:m})=>{const t=o.getContext("2d");if(!t){console.log("No canvas for display detection results!");return}const{w:d,h:a}=m,{xRatio:l,yRatio:h}=g;o.width=d,o.height=a,t.clearRect(0,0,t.canvas.width,t.canvas.height);const n=new N,u=`${Math.max(Math.round(Math.max(t.canvas.width,t.canvas.height)/40),14)}px Arial`;t.font=u,t.textBaseline="top";for(let f=0;f<c.length;++f){const j=i[f].class,p=n.get(i[f].idx),v=(c[f]*100).toFixed(1);let[w,x,F,C]=s.slice(f*4,(f+1)*4);console.log({x1:x,y1:w,x2:C,y2:F,width:C-x,height:F-w}),x/=l,C/=l,w/=h,F/=h;const y=C-x,_=F-w;t.fillStyle=N.hexToRgba(p,.2)||"rgba(25, 255, 25, 1)",t.fillRect(x,w,y,_),console.log({x1:x,y1:w,x2:C,y2:F,width:y,height:_}),t.strokeStyle=p,t.lineWidth=Math.max(Math.min(t.canvas.width,t.canvas.height)/200,2.5),t.strokeRect(x,w,y,_),t.fillStyle=p;const D=t.measureText(j+" - "+v+"%").width,L=parseInt(u,10),k=w-(L+t.lineWidth);t.fillRect(x-1,k<0?0:k,D+t.lineWidth,L+t.lineWidth),t.fillStyle="#ffffff",t.fillText(j+" - "+v+"%",x-1,k<0?0:k)}};class N{constructor(){b(this,"get",s=>this.palette[Math.floor(s)%this.n]);this.palette=["#FF3838","#FF9D97","#FF701F","#FFB21D","#CFD231","#48F90A","#92CC17","#3DDB86","#1A9334","#00D4BB","#2C99A8","#00C2FF","#344593","#6473FF","#0018EC","#8438FF","#520085","#CB38FF","#FF95C8","#FF37C7"],this.n=this.palette.length}}b(N,"hexToRgba",(s,c)=>{const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return i?`rgba(${[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)].join(", ")}, ${c})`:null});function se({fileName:o,fileUrl:s,deleteFile:c,renameFile:i}){const[g,m]=r.useState(!1),[t,d]=r.useState(!1),[a,l]=r.useState(""),[h,n]=r.useState(!1),u=r.useCallback(()=>{m(v=>!v)},[m]),f=r.useCallback(({target:v})=>{l(M(v.value))},[l]),j=r.useCallback(()=>{t?(i(o,a),d(!1),u()):(l(o),d(!0))},[t,a,d,i,u,l]),p=r.useCallback(()=>{n(v=>!v)},[n]);return e.jsxs(B.Fragment,{children:[e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"file__attribute",children:e.jsx("svg",{viewBox:"0 0 12 16",xmlns:"http://www.w3.org/2000/svg",className:"file__icon",style:{width:"16px",height:"16px"},children:e.jsx("path",{d:"M8 0H1.6C.72 0 .008.72.008 1.6L0 14.4c0 .88.712 1.6 1.592 1.6H11.2c.88 0 1.6-.72 1.6-1.6V4.8L8 0zm1.6 12.8H3.2v-1.6h6.4v1.6zm0-3.2H3.2V8h6.4v1.6zm-2.4-4V1.2l4.4 4.4H7.2z"})})}),e.jsx("div",{className:"file__attribute",style:{flex:"3 1 30px",overflow:"hidden"},onClick:()=>!t&&p(),children:t?e.jsx("input",{value:a,onChange:f}):!!o&&o||"Без имени"}),e.jsx("div",{className:"file__attribute",children:e.jsxs("div",{className:"file__controls",children:[g&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:s,download:o,onClick:u,children:e.jsx("div",{className:"file__controls-item",children:e.jsx("img",{src:W})})}),e.jsx("div",{className:"file__controls-item",onClick:j,children:t?e.jsx("img",{src:z}):e.jsx("img",{src:G})}),e.jsx("div",{className:"file__controls-item",onClick:()=>c(o),children:e.jsx("img",{src:q})})]}),e.jsx("div",{className:"file__controls-item",children:e.jsx("img",{src:Z,onClick:u})})]})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{fileUrl:s}),e.jsx(X,{fileUrl:s})]})]})}function le({uploadFiles:o}){const[s,c]=r.useState(!1),i=r.useId(),g=r.useCallback(()=>{c(!1)},[c]),m=r.useCallback(a=>{a.preventDefault(),c(!0)},[c]),t=r.useCallback(a=>{a.preventDefault(),c(!1),o(a.dataTransfer.files),console.log(a.dataTransfer.files)},[c]);function d(a){a.target.files&&o(a.target.files),console.log(a.target.files)}return e.jsxs("label",{className:"file"+(s?" addfile-dragged":""),htmlFor:i,onDragLeave:g,onDragOver:m,onDrop:t,children:[e.jsxs("div",{className:"explorer__addfile",children:[e.jsx("img",{className:"addfile-icon",src:R}),e.jsx("div",{className:"addfile-text",children:"Нажмите или перетащите файл сюда"})]}),e.jsx("input",{className:"addfile-input",type:"file",multiple:!0,id:i,onChange:d})]})}const ne="/assets/arrow-Mvz41B5M.svg";function oe(){const[o,s]=r.useState([]),i=new URLSearchParams(window.location.search).get("name"),g=r.useCallback(l=>{s(h=>S(h.filter(n=>n!==l),l))},[s]),m=r.useCallback(l=>{i&&O(l,i).then(h=>{console.log(h),h.success&&s(n=>n?n.filter(u=>u!==l):[])})},[s]),t=r.useCallback((l,h)=>{i&&V(l,h,i).then(n=>{console.log(n),n.success&&s(u=>S(u.filter(f=>f!==l),h))})},[s]);async function d(l){if(i)for(let h of l)await A(h,i).then(n=>{console.log(n),n.success&&g(h.name)})}function a(l){l.target.files&&d(l.target.files),console.log(l.target.files)}return r.useEffect(()=>(i&&T(i).then(l=>{typeof l<"u"&&l.length&&s(l)}),()=>{s([])}),[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"controls",children:[e.jsxs("div",{className:"controls__item",onClick:()=>{window.location.href="/"},children:[e.jsx("img",{className:"controls__item-icon",style:{rotate:"-90deg"},src:ne}),e.jsx("div",{className:"controls__item-text",children:"Назад"})]}),e.jsxs("label",{className:"controls__item",htmlFor:"controls-input-file",children:[e.jsx("img",{className:"controls__item-icon",src:R}),e.jsx("div",{className:"controls__item-text",children:"Добавить файл"}),e.jsx("input",{type:"file",multiple:!0,id:"controls-input-file",style:{display:"none"},onChange:a})]})]}),e.jsxs("div",{className:"file-explorer",children:[!!o&&!!o.length&&o.map(l=>e.jsx(se,{fileName:l,fileUrl:`${window.location.origin}/img/${i}/${l}`,deleteFile:m,renameFile:t},l)),e.jsx(le,{uploadFiles:d})]})]})}$.createRoot(document.getElementById("root")).render(e.jsx(P,{children:e.jsx(oe,{})}));
