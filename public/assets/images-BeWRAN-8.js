import{r as k,j as t,c as F,A as _}from"./App-Bwn2yEY9.js";function y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var c=k();const b=y(c),E="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='40'%20cy='20'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='40'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='60'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",N="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M36.5%2046V18.5H43.5V46C43.5%2047.3807%2044.6193%2048.5%2046%2048.5H50.7974L41.7145%2059.3995C40.3575%2061.0279%2041.5155%2063.5%2043.635%2063.5H63.5V64.5H16.5V63.5H36.365C38.4846%2063.5%2039.6424%2061.0279%2038.2855%2059.3995L29.2026%2048.5H34C35.3807%2048.5%2036.5%2047.3807%2036.5%2046ZM51.4808%2047.6799L51.4801%2047.6808L51.4808%2047.6799Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",L="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.4395%2049.1875L36.8032%2062.0992C39.673%2063.756%2043.3425%2062.7728%2044.9994%2059.903L63.1016%2028.549C63.6539%2027.5925%2063.3261%2026.3693%2062.3696%2025.817L60.6375%2024.817C59.6809%2024.2647%2058.4577%2024.5925%2057.9055%2025.549L41.8032%2053.4389C40.6986%2055.3521%2038.2523%2056.0076%2036.3391%2054.903L16.4003%2043.3913C15.2524%2042.7286%2013.7845%2043.1219%2013.1218%2044.2698C12.1277%2045.9916%2012.7177%2048.1934%2014.4395%2049.1875Z'%20fill='%2300FF00'/%3e%3c/svg%3e",D="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M20.648%2058.3191L24.5995%2045.9482L54.9086%2015.6391L63.8528%2023.6655L36.2782%2051.2401L32.7507%2048.1247C31.7609%2047.2505%2030.2619%2047.297%2029.328%2048.2308L29.0307%2048.5281C28.0113%2049.5475%2028.063%2051.2154%2029.1435%2052.1697L31.7166%2054.4422L20.648%2058.3191ZM32.5217%2054.1602L32.521%2054.1605L32.5217%2054.1602Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3crect%20x='13.5'%20y='62.5978'%20width='49'%20height='3'%20fill='black'%20stroke='black'/%3e%3c/svg%3e",S="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='16'%20y='21'%20width='48'%20height='2'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M52%2064H28C25.2386%2064%2023%2061.7614%2023%2059V29C23%2028.4477%2023.4477%2028%2024%2028H24.2353C24.7876%2028%2025.2353%2028.4477%2025.2353%2029V57C25.2353%2059.7614%2027.4739%2062%2030.2353%2062H49.7647C52.5261%2062%2054.7647%2059.7614%2054.7647%2057V29C54.7647%2028.4477%2055.2124%2028%2055.7647%2028H56C56.5523%2028%2057%2028.4477%2057%2029V59C57%2061.7614%2054.7614%2064%2052%2064Z'%20fill='%23FF0000'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='34'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='44'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M32%2016C32%2014.8954%2032.8954%2014%2034%2014H46C47.1046%2014%2048%2014.8954%2048%2016V20H32V16Z'%20fill='%23FF0000'/%3e%3c/svg%3e";function I(e){const s=/[^\w\-.\ а-яА-ЯёЁїЇєЄа-яЁё一-龯ぁ-んァ-ン\u2E80-\u2FFF]/g;let i=e.replace(/[&<>"'/]/g,a=>{switch(a){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";case"/":return"&#47;";default:return""}});return i=i.replace(s,""),i}function w(e,s){const a=O(e,s,(h,n)=>h>n?"more":h===n?"equal":"less");return typeof a>"u"?[s]:a===-1?[s].concat(e):a===e.length?e.concat([s]):e.slice(0,a).concat([s],e.slice(a))}function O(e,s,i){const a={min:0,max:e.length-1};let h;if(a.max<0)return h;let n=!1;for(i(s,e[a.min])==="less"&&(h=-1,n=!0),i(s,e[a.max])==="more"&&(h=e.length,n=!0);!n;){const{min:o,max:l}=a;if(o===l||o===l-1){h=l,n=!0;break}const r=o+parseInt((l-o)/2+"");switch(i(s,e[r])){case"less":a.max=r;break;case"equal":h=r,n=!0;break;case"more":a.min=r;break}}return h}const H="modulepreload",R=function(e){return"/"+e},v={},V=function(s,i,a){let h=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));h=Promise.allSettled(i.map(r=>{if(r=R(r),r in v)return;v[r]=!0;const d=r.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${g}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":H,d||(u.as="script"),u.crossOrigin="",u.href=r,l&&u.setAttribute("nonce",l),document.head.appendChild(u),d)return new Promise((f,m)=>{u.addEventListener("load",f),u.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${r}`)))})}))}function n(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return h.then(o=>{for(const l of o||[])l.status==="rejected"&&n(l.reason);return s().catch(n)})};function T({fileUrl:e}){const[s,i]=c.useState(null),[a,h]=c.useState(0),[n,o]=c.useState(null),l=c.useRef(null),r=c.useId(),d=c.useCallback(()=>{h(u=>(u+1)%2)},[h]);c.useEffect(()=>{if(n){if(a===0)s.imshow(r,n);else if(a===1){let u=new s.Mat;s.cvtColor(n,u,s.COLOR_RGBA2GRAY,0),s.imshow(r,u),u.delete()}}},[a,n,r]);const g=()=>{if(!s)return;const u=document.createElement("img");u.src=e,u.onload=()=>o(s.imread(u))};return c.useEffect(()=>{(async()=>{const{cvFactory:f}=await V(async()=>{const{cvFactory:m}=await import("./opencv-BfzHwUv7.js");return{cvFactory:m}},[]);f.then(m=>{i(m),console.log("CV loaded!")})})()},[]),c.useEffect(()=>{s&&g()},[s]),t.jsxs("div",{className:"file-content",children:[t.jsx("div",{className:"image__controls",children:t.jsxs("div",{className:"image__controls-toggle",children:[t.jsx("div",{children:"Color"}),t.jsx("input",{type:"checkbox",className:"toggle-button",onChange:d}),t.jsx("div",{children:"Gray"})]})}),t.jsx("img",{ref:l,src:e}),t.jsx("canvas",{id:r})]})}function P({fileName:e,fileUrl:s,deleteFile:i,renameFile:a}){const[h,n]=c.useState(!1),[o,l]=c.useState(!1),[r,d]=c.useState(""),[g,u]=c.useState(!1),f=c.useCallback(()=>{n(x=>!x)},[n]),m=c.useCallback(({target:x})=>{d(I(x.value))},[d]),C=c.useCallback(()=>{o?(a(e,r),l(!1),f()):(d(e),l(!0))},[o,r,l,a,f,d]),j=c.useCallback(()=>{u(x=>!x)},[u]);return t.jsxs(b.Fragment,{children:[t.jsxs("div",{className:"file",children:[t.jsx("div",{className:"file__attribute",children:t.jsx("svg",{viewBox:"0 0 12 16",xmlns:"http://www.w3.org/2000/svg",className:"file__icon",style:{width:"16px",height:"16px"},children:t.jsx("path",{d:"M8 0H1.6C.72 0 .008.72.008 1.6L0 14.4c0 .88.712 1.6 1.592 1.6H11.2c.88 0 1.6-.72 1.6-1.6V4.8L8 0zm1.6 12.8H3.2v-1.6h6.4v1.6zm0-3.2H3.2V8h6.4v1.6zm-2.4-4V1.2l4.4 4.4H7.2z"})})}),t.jsx("div",{className:"file__attribute",style:{flex:"3 1 30px",overflow:"hidden"},onClick:()=>!o&&j(),children:o?t.jsx("input",{value:r,onChange:m}):!!e&&e||"Без имени"}),t.jsx("div",{className:"file__attribute",children:t.jsxs("div",{className:"file__controls",children:[h&&t.jsxs(t.Fragment,{children:[t.jsx("a",{href:s,download:e,onClick:f,children:t.jsx("div",{className:"file__controls-item",children:t.jsx("img",{src:N})})}),t.jsx("div",{className:"file__controls-item",onClick:C,children:o?t.jsx("img",{src:L}):t.jsx("img",{src:D})}),t.jsx("div",{className:"file__controls-item",onClick:()=>i(e),children:t.jsx("img",{src:S})})]}),t.jsx("div",{className:"file__controls-item",children:t.jsx("img",{src:E,onClick:f})})]})})]}),g&&t.jsx(T,{fileUrl:s})]})}function M(){return fetch(window.location.origin+"/api/images",{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>{if(e.ok)return e.json()})}function B(e){const s=new FormData;return s.append("file",e),fetch(window.location.origin+"/api/upload/",{method:"PUT",body:s}).then(i=>i.json())}function A(e){return fetch(window.location.origin+"/api/remove",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:e})}).then(s=>s.json())}function Z(e,s){return fetch(window.location.origin+"/api/rename",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:e,newName:s})}).then(i=>i.json())}const p="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='36'%20y='69'%20width='58'%20height='8'%20rx='3'%20transform='rotate(-90%2036%2069)'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='2'/%3e%3crect%20x='11'%20y='36'%20width='58'%20height='8'%20rx='2.75'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='2'/%3e%3crect%20x='37'%20y='46'%20width='12'%20height='6'%20transform='rotate(-90%2037%2046)'%20fill='%23F8F6ED'/%3e%3c/svg%3e";function q({addFile:e}){const[s,i]=c.useState(!1),a=c.useId(),h=c.useCallback(()=>{i(!1)},[i]),n=c.useCallback(d=>{d.preventDefault(),i(!0)},[i]),o=c.useCallback(d=>{d.preventDefault(),i(!1),r(d.dataTransfer.files),console.log(d.dataTransfer.files)},[i]);function l(d){d.target.files&&r(d.target.files),console.log(d.target.files)}async function r(d){for(let g of d)await B(g).then(u=>{console.log(u),u.success&&e(g.name)})}return t.jsxs("label",{className:"file"+(s?" addfile-dragged":""),htmlFor:a,onDragLeave:h,onDragOver:n,onDrop:o,children:[t.jsxs("div",{className:"explorer__addfile",children:[t.jsx("img",{className:"addfile-icon",src:p}),t.jsx("div",{className:"addfile-text",children:"Нажмите или перетащите файл сюда"})]}),t.jsx("input",{className:"addfile-input",type:"file",multiple:!0,id:a,onChange:l})]})}function z(){const[e,s]=c.useState([]),i=c.useCallback(n=>{s(o=>w(o.filter(l=>l!==n),n))},[s]),a=c.useCallback(n=>{A(n).then(o=>{console.log(o),o.success&&s(l=>l?l.filter(r=>r!==n):[])})},[s]),h=c.useCallback((n,o)=>{Z(n,o).then(l=>{console.log(l),l.success&&s(r=>w(r.filter(d=>d!==n),o))})},[s]);return c.useEffect(()=>(M().then(n=>{typeof n<"u"&&n.length&&s(n)}),()=>{s([])}),[]),t.jsxs("div",{className:"explorer",children:[!!e&&!!e.length&&e.map(n=>t.jsx(P,{fileName:n,fileUrl:window.location.origin+"/img/"+n,deleteFile:a,renameFile:h},n)),t.jsx(q,{addFile:i})]})}const G="/assets/arrow-qCuS77Qj.svg";function U(){return t.jsxs("div",{className:"controls",children:[t.jsxs("div",{className:"controls__item",children:[t.jsx("img",{className:"controls__item-icon",style:{rotate:"-90deg"},src:G}),t.jsx("div",{className:"controls__item-text",children:"Назад"})]}),t.jsxs("div",{className:"controls__item",children:[t.jsx("img",{className:"controls__item-icon",src:p}),t.jsx("div",{className:"controls__item-text",children:"Добавить файл"})]})]})}F.createRoot(document.getElementById("root")).render(t.jsxs(_,{children:[t.jsx(U,{}),t.jsx(z,{})]}));
