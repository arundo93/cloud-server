var L=Object.defineProperty;var S=(a,t,i)=>t in a?L(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i;var C=(a,t,i)=>S(a,typeof t!="symbol"?t+"":t,i);import{r,j as e,d as E,R,p as b,i as y,e as D,f as I,h as H,u as B,b as M,A as O}from"./images-CmLipUHc.js";const V="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='40'%20cy='20'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='40'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='60'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",T="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M36.5%2046V18.5H43.5V46C43.5%2047.3807%2044.6193%2048.5%2046%2048.5H50.7974L41.7145%2059.3995C40.3575%2061.0279%2041.5155%2063.5%2043.635%2063.5H63.5V64.5H16.5V63.5H36.365C38.4846%2063.5%2039.6424%2061.0279%2038.2855%2059.3995L29.2026%2048.5H34C35.3807%2048.5%2036.5%2047.3807%2036.5%2046ZM51.4808%2047.6799L51.4801%2047.6808L51.4808%2047.6799Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",A="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.4395%2049.1875L36.8032%2062.0992C39.673%2063.756%2043.3425%2062.7728%2044.9994%2059.903L63.1016%2028.549C63.6539%2027.5925%2063.3261%2026.3693%2062.3696%2025.817L60.6375%2024.817C59.6809%2024.2647%2058.4577%2024.5925%2057.9055%2025.549L41.8032%2053.4389C40.6986%2055.3521%2038.2523%2056.0076%2036.3391%2054.903L16.4003%2043.3913C15.2524%2042.7286%2013.7845%2043.1219%2013.1218%2044.2698C12.1277%2045.9916%2012.7177%2048.1934%2014.4395%2049.1875Z'%20fill='%2300FF00'/%3e%3c/svg%3e",$="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M20.648%2058.3191L24.5995%2045.9482L54.9086%2015.6391L63.8528%2023.6655L36.2782%2051.2401L32.7507%2048.1247C31.7609%2047.2505%2030.2619%2047.297%2029.328%2048.2308L29.0307%2048.5281C28.0113%2049.5475%2028.063%2051.2154%2029.1435%2052.1697L31.7166%2054.4422L20.648%2058.3191ZM32.5217%2054.1602L32.521%2054.1605L32.5217%2054.1602Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3crect%20x='13.5'%20y='62.5978'%20width='49'%20height='3'%20fill='black'%20stroke='black'/%3e%3c/svg%3e",P="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='16'%20y='21'%20width='48'%20height='2'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M52%2064H28C25.2386%2064%2023%2061.7614%2023%2059V29C23%2028.4477%2023.4477%2028%2024%2028H24.2353C24.7876%2028%2025.2353%2028.4477%2025.2353%2029V57C25.2353%2059.7614%2027.4739%2062%2030.2353%2062H49.7647C52.5261%2062%2054.7647%2059.7614%2054.7647%2057V29C54.7647%2028.4477%2055.2124%2028%2055.7647%2028H56C56.5523%2028%2057%2028.4477%2057%2029V59C57%2061.7614%2054.7614%2064%2052%2064Z'%20fill='%23FF0000'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='34'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='44'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M32%2016C32%2014.8954%2032.8954%2014%2034%2014H46C47.1046%2014%2048%2014.8954%2048%2016V20H32V16Z'%20fill='%23FF0000'/%3e%3c/svg%3e",Z="modulepreload",W=function(a){return"/"+a},_={},z=function(t,i,c){let h=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),g=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));h=Promise.allSettled(i.map(n=>{if(n=W(n),n in _)return;_[n]=!0;const l=n.endsWith(".css"),m=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${m}`))return;const o=document.createElement("link");if(o.rel=l?"stylesheet":Z,l||(o.as="script"),o.crossOrigin="",o.href=n,g&&o.setAttribute("nonce",g),document.head.appendChild(o),l)return new Promise((f,u)=>{o.addEventListener("load",f),o.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${n}`)))})}))}function s(d){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=d,window.dispatchEvent(g),!g.defaultPrevented)throw d}return h.then(d=>{for(const g of d||[])g.status==="rejected"&&s(g.reason);return t().catch(s)})},q={enable:!1,colorSpace:"color"};function G({fileUrl:a}){const[t,i]=r.useState(null),[c,h]=r.useState(q),[s,d]=r.useState(null),g=r.useRef(null),n=r.useId(),l=r.useCallback(()=>{h(o=>({...o,colorSpace:o.colorSpace==="color"?"gray":"color"}))},[h]);r.useEffect(()=>{if(c.enable){if(c.colorSpace==="color")t.imshow(n,s);else if(c.colorSpace==="gray"){let o=new t.Mat;t.cvtColor(s,o,t.COLOR_RGBA2GRAY,0),t.imshow(n,o),o.delete()}}},[c,s,n]);const m=()=>{if(t)try{d(t.imread(g.current)),h(o=>({...o,enable:!0}))}catch(o){console.log(o)}};return r.useEffect(()=>{(async()=>{const{cvFactory:f}=await z(async()=>{const{cvFactory:u}=await import("./opencv-BfzHwUv7.js");return{cvFactory:u}},[]);f.then(u=>{i(u),console.log("CV loaded!")})})()},[]),e.jsxs("div",{className:"file-content",children:[e.jsx("div",{className:"image__controls",children:e.jsxs("div",{className:"image__controls-toggle",children:[e.jsx("div",{children:"Color"}),e.jsx("input",{type:"checkbox",className:"toggle-button",onChange:l}),e.jsx("div",{children:"Gray"})]})}),!!t&&e.jsxs(e.Fragment,{children:[e.jsx("img",{ref:g,src:a,onLoad:m}),e.jsx("canvas",{id:n})]})]})}function U({fileUrl:a}){const[t,i]=a.split("/").slice(-2),c=r.useRef(null);return r.useEffect(()=>{J(t,i).then(h=>{if(h){console.log(h);for(let s in h)h[s]=Object.values(h[s]);Q({canvasRef:c.current,...h})}})},[]),e.jsxs("div",{className:"detector-container",children:[e.jsx("canvas",{className:"detector-canvas",ref:c}),e.jsx("img",{src:a})]})}function J(a,t){return fetch(window.location.origin+"/api/predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({foldername:a,filename:t})}).then(i=>{if(i.ok)return i.json();(i.status===400||i.status===500)&&i.json().then(c=>{console.log(c)})})}const Q=({canvasRef:a,boxes_data:t,scores_data:i,classes_data:c,ratios:h})=>{const s=a.getContext("2d");if(!s){console.log("No canvas for display detection results!");return}s.clearRect(0,0,s.canvas.width,s.canvas.height);const d=new j,g=`${Math.max(Math.round(Math.max(s.canvas.width,s.canvas.height)/40),14)}px Arial`;s.font=g,s.textBaseline="top";for(let n=0;n<i.length;++n){const l=c[n],m=d.get(c[n]),o=(i[n]*100).toFixed(1);let[f,u,v,w]=t.slice(n*4,(n+1)*4);console.log({x1:u,y1:f,x2:w,y2:v,width:w-u,height:v-f}),u/=h[0],w/=h[0],f/=h[1],v/=h[1];const x=w-u,F=v-f;s.fillStyle=j.hexToRgba(m,.2)||"rgba(25, 255, 25, 1)",s.fillRect(u,f,x,F),console.log({x1:u,y1:f,x2:w,y2:v,width:x,height:F}),s.strokeStyle=m,s.lineWidth=Math.max(Math.min(s.canvas.width,s.canvas.height)/200,2.5),s.strokeRect(u,f,x,F),s.fillStyle=m;const N=s.measureText(l+" - "+o+"%").width,k=parseInt(g,10),p=f-(k+s.lineWidth);s.fillRect(u-1,p<0?0:p,N+s.lineWidth,k+s.lineWidth),s.fillStyle="#ffffff",s.fillText(l+" - "+o+"%",u-1,p<0?0:p)}};class j{constructor(){C(this,"get",t=>this.palette[Math.floor(t)%this.n]);this.palette=["#FF3838","#FF9D97","#FF701F","#FFB21D","#CFD231","#48F90A","#92CC17","#3DDB86","#1A9334","#00D4BB","#2C99A8","#00C2FF","#344593","#6473FF","#0018EC","#8438FF","#520085","#CB38FF","#FF95C8","#FF37C7"],this.n=this.palette.length}}C(j,"hexToRgba",(t,i)=>{const c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return c?`rgba(${[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)].join(", ")}, ${i})`:null});function Y({fileName:a,fileUrl:t,deleteFile:i,renameFile:c}){const[h,s]=r.useState(!1),[d,g]=r.useState(!1),[n,l]=r.useState(""),[m,o]=r.useState(!1),f=r.useCallback(()=>{s(x=>!x)},[s]),u=r.useCallback(({target:x})=>{l(E(x.value))},[l]),v=r.useCallback(()=>{d?(c(a,n),g(!1),f()):(l(a),g(!0))},[d,n,g,c,f,l]),w=r.useCallback(()=>{o(x=>!x)},[o]);return e.jsxs(R.Fragment,{children:[e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"file__attribute",children:e.jsx("svg",{viewBox:"0 0 12 16",xmlns:"http://www.w3.org/2000/svg",className:"file__icon",style:{width:"16px",height:"16px"},children:e.jsx("path",{d:"M8 0H1.6C.72 0 .008.72.008 1.6L0 14.4c0 .88.712 1.6 1.592 1.6H11.2c.88 0 1.6-.72 1.6-1.6V4.8L8 0zm1.6 12.8H3.2v-1.6h6.4v1.6zm0-3.2H3.2V8h6.4v1.6zm-2.4-4V1.2l4.4 4.4H7.2z"})})}),e.jsx("div",{className:"file__attribute",style:{flex:"3 1 30px",overflow:"hidden"},onClick:()=>!d&&w(),children:d?e.jsx("input",{value:n,onChange:u}):!!a&&a||"Без имени"}),e.jsx("div",{className:"file__attribute",children:e.jsxs("div",{className:"file__controls",children:[h&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:t,download:a,onClick:f,children:e.jsx("div",{className:"file__controls-item",children:e.jsx("img",{src:T})})}),e.jsx("div",{className:"file__controls-item",onClick:v,children:d?e.jsx("img",{src:A}):e.jsx("img",{src:$})}),e.jsx("div",{className:"file__controls-item",onClick:()=>i(a),children:e.jsx("img",{src:P})})]}),e.jsx("div",{className:"file__controls-item",children:e.jsx("img",{src:V,onClick:f})})]})})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx(G,{fileUrl:t}),e.jsx(U,{fileUrl:t})]})]})}function K({uploadFiles:a}){const[t,i]=r.useState(!1),c=r.useId(),h=r.useCallback(()=>{i(!1)},[i]),s=r.useCallback(n=>{n.preventDefault(),i(!0)},[i]),d=r.useCallback(n=>{n.preventDefault(),i(!1),a(n.dataTransfer.files),console.log(n.dataTransfer.files)},[i]);function g(n){n.target.files&&a(n.target.files),console.log(n.target.files)}return e.jsxs("label",{className:"file"+(t?" addfile-dragged":""),htmlFor:c,onDragLeave:h,onDragOver:s,onDrop:d,children:[e.jsxs("div",{className:"explorer__addfile",children:[e.jsx("img",{className:"addfile-icon",src:b}),e.jsx("div",{className:"addfile-text",children:"Нажмите или перетащите файл сюда"})]}),e.jsx("input",{className:"addfile-input",type:"file",multiple:!0,id:c,onChange:g})]})}const X="/assets/arrow-qCuS77Qj.svg";function ee(){const[a,t]=r.useState([]),c=new URLSearchParams(window.location.search).get("name"),h=r.useCallback(l=>{t(m=>y(m.filter(o=>o!==l),l))},[t]),s=r.useCallback(l=>{c&&D(l,c).then(m=>{console.log(m),m.success&&t(o=>o?o.filter(f=>f!==l):[])})},[t]),d=r.useCallback((l,m)=>{c&&I(l,m,c).then(o=>{console.log(o),o.success&&t(f=>y(f.filter(u=>u!==l),m))})},[t]);async function g(l){if(c)for(let m of l)await B(m,c).then(o=>{console.log(o),o.success&&h(m.name)})}function n(l){l.target.files&&g(l.target.files),console.log(l.target.files)}return r.useEffect(()=>(c&&H(c).then(l=>{typeof l<"u"&&l.length&&t(l)}),()=>{t([])}),[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"controls",children:[e.jsxs("div",{className:"controls__item",onClick:()=>{window.location.href="/"},children:[e.jsx("img",{className:"controls__item-icon",style:{rotate:"-90deg"},src:X}),e.jsx("div",{className:"controls__item-text",children:"Назад"})]}),e.jsxs("label",{className:"controls__item",htmlFor:"controls-input-file",children:[e.jsx("img",{className:"controls__item-icon",src:b}),e.jsx("div",{className:"controls__item-text",children:"Добавить файл"}),e.jsx("input",{type:"file",multiple:!0,id:"controls-input-file",style:{display:"none"},onChange:n})]})]}),e.jsxs("div",{className:"file-explorer",children:[!!a&&!!a.length&&a.map(l=>e.jsx(Y,{fileName:l,fileUrl:`${window.location.origin}/img/${c}/${l}`,deleteFile:s,renameFile:d},l)),e.jsx(K,{uploadFiles:g})]})]})}M.createRoot(document.getElementById("root")).render(e.jsx(O,{children:e.jsx(ee,{})}));
