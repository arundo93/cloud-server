var L=Object.defineProperty;var S=(a,t,i)=>t in a?L(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i;var C=(a,t,i)=>S(a,typeof t!="symbol"?t+"":t,i);import{r,j as e,d as E,R,p as b,i as y,e as D,f as I,h as H,u as B,b as M,A as O}from"./images-CsHUxV9s.js";const V="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='40'%20cy='20'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='40'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3ccircle%20cx='40'%20cy='60'%20r='6.5'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",T="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M36.5%2046V18.5H43.5V46C43.5%2047.3807%2044.6193%2048.5%2046%2048.5H50.7974L41.7145%2059.3995C40.3575%2061.0279%2041.5155%2063.5%2043.635%2063.5H63.5V64.5H16.5V63.5H36.365C38.4846%2063.5%2039.6424%2061.0279%2038.2855%2059.3995L29.2026%2048.5H34C35.3807%2048.5%2036.5%2047.3807%2036.5%2046ZM51.4808%2047.6799L51.4801%2047.6808L51.4808%2047.6799Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3c/svg%3e",A="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.4395%2049.1875L36.8032%2062.0992C39.673%2063.756%2043.3425%2062.7728%2044.9994%2059.903L63.1016%2028.549C63.6539%2027.5925%2063.3261%2026.3693%2062.3696%2025.817L60.6375%2024.817C59.6809%2024.2647%2058.4577%2024.5925%2057.9055%2025.549L41.8032%2053.4389C40.6986%2055.3521%2038.2523%2056.0076%2036.3391%2054.903L16.4003%2043.3913C15.2524%2042.7286%2013.7845%2043.1219%2013.1218%2044.2698C12.1277%2045.9916%2012.7177%2048.1934%2014.4395%2049.1875Z'%20fill='%2300FF00'/%3e%3c/svg%3e",$="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M20.648%2058.3191L24.5995%2045.9482L54.9086%2015.6391L63.8528%2023.6655L36.2782%2051.2401L32.7507%2048.1247C31.7609%2047.2505%2030.2619%2047.297%2029.328%2048.2308L29.0307%2048.5281C28.0113%2049.5475%2028.063%2051.2154%2029.1435%2052.1697L31.7166%2054.4422L20.648%2058.3191ZM32.5217%2054.1602L32.521%2054.1605L32.5217%2054.1602Z'%20fill='%23F8F6ED'%20stroke='black'%20stroke-width='3'/%3e%3crect%20x='13.5'%20y='62.5978'%20width='49'%20height='3'%20fill='black'%20stroke='black'/%3e%3c/svg%3e",P="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='16'%20y='21'%20width='48'%20height='2'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M52%2064H28C25.2386%2064%2023%2061.7614%2023%2059V29C23%2028.4477%2023.4477%2028%2024%2028H24.2353C24.7876%2028%2025.2353%2028.4477%2025.2353%2029V57C25.2353%2059.7614%2027.4739%2062%2030.2353%2062H49.7647C52.5261%2062%2054.7647%2059.7614%2054.7647%2057V29C54.7647%2028.4477%2055.2124%2028%2055.7647%2028H56C56.5523%2028%2057%2028.4477%2057%2029V59C57%2061.7614%2054.7614%2064%2052%2064Z'%20fill='%23FF0000'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='34'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3crect%20x='44'%20y='33'%20width='2'%20height='22'%20rx='1'%20stroke='%23FF0000'%20stroke-width='2'/%3e%3cpath%20d='M32%2016C32%2014.8954%2032.8954%2014%2034%2014H46C47.1046%2014%2048%2014.8954%2048%2016V20H32V16Z'%20fill='%23FF0000'/%3e%3c/svg%3e",Z="modulepreload",W=function(a){return"/"+a},_={},z=function(t,i,c){let f=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));f=Promise.allSettled(i.map(l=>{if(l=W(l),l in _)return;_[l]=!0;const n=l.endsWith(".css"),g=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${g}`))return;const o=document.createElement("link");if(o.rel=n?"stylesheet":Z,n||(o.as="script"),o.crossOrigin="",o.href=l,h&&o.setAttribute("nonce",h),document.head.appendChild(o),n)return new Promise((u,m)=>{o.addEventListener("load",u),o.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return f.then(d=>{for(const h of d||[])h.status==="rejected"&&s(h.reason);return t().catch(s)})},q={enable:!1,colorSpace:"color"};function G({fileUrl:a}){const[t,i]=r.useState(null),[c,f]=r.useState(q),[s,d]=r.useState(null),h=r.useRef(null),l=r.useId(),n=r.useCallback(()=>{f(o=>({...o,colorSpace:o.colorSpace==="color"?"gray":"color"}))},[f]);r.useEffect(()=>{if(c.enable){if(c.colorSpace==="color")t.imshow(l,s);else if(c.colorSpace==="gray"){let o=new t.Mat;t.cvtColor(s,o,t.COLOR_RGBA2GRAY,0),t.imshow(l,o),o.delete()}}},[c,s,l]);const g=()=>{if(t)try{d(t.imread(h.current)),f(o=>({...o,enable:!0}))}catch(o){console.log(o)}};return r.useEffect(()=>{(async()=>{const{cvFactory:u}=await z(async()=>{const{cvFactory:m}=await import("./opencv-BfzHwUv7.js");return{cvFactory:m}},[]);u.then(m=>{i(m),console.log("CV loaded!")})})()},[]),e.jsxs("div",{className:"file-content",children:[e.jsx("div",{className:"image__controls",children:e.jsxs("div",{className:"image__controls-toggle",children:[e.jsx("div",{children:"Color"}),e.jsx("input",{type:"checkbox",className:"toggle-button",onChange:n}),e.jsx("div",{children:"Gray"})]})}),!!t&&e.jsxs(e.Fragment,{children:[e.jsx("img",{ref:h,src:a,onLoad:g}),e.jsx("canvas",{id:l})]})]})}function U({fileUrl:a}){const[t,i]=a.split("/").slice(-2),c=r.useRef(null);return r.useEffect(()=>{J(t,i).then(f=>{f&&Q({canvasRef:c.current,...f})})},[]),e.jsxs("div",{className:"detector-container",children:[e.jsx("canvas",{className:"detector-canvas",ref:c}),e.jsx("img",{src:a})]})}function J(a,t){return fetch(window.location.origin+"/api/predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({foldername:a,filename:t})}).then(i=>{if(i.ok)return i.json();(i.status===400||i.status===500)&&i.json().then(c=>{console.log(c)})})}const Q=({canvasRef:a,boxes_data:t,scores_data:i,classes_data:c,ratios:f})=>{const s=a.getContext("2d");if(!s){console.log("No canvas for display detection results!");return}s.clearRect(0,0,s.canvas.width,s.canvas.height);const d=new j,h=`${Math.max(Math.round(Math.max(s.canvas.width,s.canvas.height)/40),14)}px Arial`;s.font=h,s.textBaseline="top";for(let l=0;l<i.length;++l){const n=c[l],g=d.get(c[l]),o=(i[l]*100).toFixed(1);let[u,m,v,p]=t.slice(l*4,(l+1)*4);m*=f[0],p*=f[0],u*=f[1],v*=f[1];const x=p-m,F=v-u;s.fillStyle=j.hexToRgba(g,.2)||"rgba(25, 255, 25, 1)",s.fillRect(m,u,x,F),console.log([m,u,x,F]),s.strokeStyle=g,s.lineWidth=Math.max(Math.min(s.canvas.width,s.canvas.height)/200,2.5),s.strokeRect(m,u,x,F),s.fillStyle=g;const N=s.measureText(n+" - "+o+"%").width,k=parseInt(h,10),w=u-(k+s.lineWidth);s.fillRect(m-1,w<0?0:w,N+s.lineWidth,k+s.lineWidth),s.fillStyle="#ffffff",s.fillText(n+" - "+o+"%",m-1,w<0?0:w)}};class j{constructor(){C(this,"get",t=>this.palette[Math.floor(t)%this.n]);this.palette=["#FF3838","#FF9D97","#FF701F","#FFB21D","#CFD231","#48F90A","#92CC17","#3DDB86","#1A9334","#00D4BB","#2C99A8","#00C2FF","#344593","#6473FF","#0018EC","#8438FF","#520085","#CB38FF","#FF95C8","#FF37C7"],this.n=this.palette.length}}C(j,"hexToRgba",(t,i)=>{const c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return c?`rgba(${[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)].join(", ")}, ${i})`:null});function Y({fileName:a,fileUrl:t,deleteFile:i,renameFile:c}){const[f,s]=r.useState(!1),[d,h]=r.useState(!1),[l,n]=r.useState(""),[g,o]=r.useState(!1),u=r.useCallback(()=>{s(x=>!x)},[s]),m=r.useCallback(({target:x})=>{n(E(x.value))},[n]),v=r.useCallback(()=>{d?(c(a,l),h(!1),u()):(n(a),h(!0))},[d,l,h,c,u,n]),p=r.useCallback(()=>{o(x=>!x)},[o]);return e.jsxs(R.Fragment,{children:[e.jsxs("div",{className:"file",children:[e.jsx("div",{className:"file__attribute",children:e.jsx("svg",{viewBox:"0 0 12 16",xmlns:"http://www.w3.org/2000/svg",className:"file__icon",style:{width:"16px",height:"16px"},children:e.jsx("path",{d:"M8 0H1.6C.72 0 .008.72.008 1.6L0 14.4c0 .88.712 1.6 1.592 1.6H11.2c.88 0 1.6-.72 1.6-1.6V4.8L8 0zm1.6 12.8H3.2v-1.6h6.4v1.6zm0-3.2H3.2V8h6.4v1.6zm-2.4-4V1.2l4.4 4.4H7.2z"})})}),e.jsx("div",{className:"file__attribute",style:{flex:"3 1 30px",overflow:"hidden"},onClick:()=>!d&&p(),children:d?e.jsx("input",{value:l,onChange:m}):!!a&&a||"Без имени"}),e.jsx("div",{className:"file__attribute",children:e.jsxs("div",{className:"file__controls",children:[f&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:t,download:a,onClick:u,children:e.jsx("div",{className:"file__controls-item",children:e.jsx("img",{src:T})})}),e.jsx("div",{className:"file__controls-item",onClick:v,children:d?e.jsx("img",{src:A}):e.jsx("img",{src:$})}),e.jsx("div",{className:"file__controls-item",onClick:()=>i(a),children:e.jsx("img",{src:P})})]}),e.jsx("div",{className:"file__controls-item",children:e.jsx("img",{src:V,onClick:u})})]})})]}),g&&e.jsxs(e.Fragment,{children:[e.jsx(G,{fileUrl:t}),e.jsx(U,{fileUrl:t})]})]})}function K({uploadFiles:a}){const[t,i]=r.useState(!1),c=r.useId(),f=r.useCallback(()=>{i(!1)},[i]),s=r.useCallback(l=>{l.preventDefault(),i(!0)},[i]),d=r.useCallback(l=>{l.preventDefault(),i(!1),a(l.dataTransfer.files),console.log(l.dataTransfer.files)},[i]);function h(l){l.target.files&&a(l.target.files),console.log(l.target.files)}return e.jsxs("label",{className:"file"+(t?" addfile-dragged":""),htmlFor:c,onDragLeave:f,onDragOver:s,onDrop:d,children:[e.jsxs("div",{className:"explorer__addfile",children:[e.jsx("img",{className:"addfile-icon",src:b}),e.jsx("div",{className:"addfile-text",children:"Нажмите или перетащите файл сюда"})]}),e.jsx("input",{className:"addfile-input",type:"file",multiple:!0,id:c,onChange:h})]})}const X="/assets/arrow-qCuS77Qj.svg";function ee(){const[a,t]=r.useState([]),c=new URLSearchParams(window.location.search).get("name"),f=r.useCallback(n=>{t(g=>y(g.filter(o=>o!==n),n))},[t]),s=r.useCallback(n=>{c&&D(n,c).then(g=>{console.log(g),g.success&&t(o=>o?o.filter(u=>u!==n):[])})},[t]),d=r.useCallback((n,g)=>{c&&I(n,g,c).then(o=>{console.log(o),o.success&&t(u=>y(u.filter(m=>m!==n),g))})},[t]);async function h(n){if(c)for(let g of n)await B(g,c).then(o=>{console.log(o),o.success&&f(g.name)})}function l(n){n.target.files&&h(n.target.files),console.log(n.target.files)}return r.useEffect(()=>(c&&H(c).then(n=>{typeof n<"u"&&n.length&&t(n)}),()=>{t([])}),[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"controls",children:[e.jsxs("div",{className:"controls__item",onClick:()=>{window.location.href="/"},children:[e.jsx("img",{className:"controls__item-icon",style:{rotate:"-90deg"},src:X}),e.jsx("div",{className:"controls__item-text",children:"Назад"})]}),e.jsxs("label",{className:"controls__item",htmlFor:"controls-input-file",children:[e.jsx("img",{className:"controls__item-icon",src:b}),e.jsx("div",{className:"controls__item-text",children:"Добавить файл"}),e.jsx("input",{type:"file",multiple:!0,id:"controls-input-file",style:{display:"none"},onChange:l})]})]}),e.jsxs("div",{className:"file-explorer",children:[!!a&&!!a.length&&a.map(n=>e.jsx(Y,{fileName:n,fileUrl:`${window.location.origin}/img/${c}/${n}`,deleteFile:s,renameFile:d},n)),e.jsx(K,{uploadFiles:h})]})]})}M.createRoot(document.getElementById("root")).render(e.jsx(O,{children:e.jsx(ee,{})}));
